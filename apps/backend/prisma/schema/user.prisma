// prisma/schema/user.prisma

model User {
  id         String          @id @default(cuid())
  username   String          @unique
  email      String?         @unique
  firstName  String?
  lastName   String?
  passwordHash String
  isActive   Boolean         @default(true)

  tenantId   String
  tenant     Tenant          @relation(fields: [tenantId], references: [id], onDelete: Restrict)
  
  auditLogs  AuditLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  deletedByUserId String? 
  deletedByUser User? @relation("deleted_users", fields: [deletedByUserId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  deletedPermissions UserPermission[] @relation("deleted_user_permissions")

  deletedUsers User[] @relation("deleted_users")
  deletedAt DateTime? @db.Timestamp(0)

  @@index([tenantId, deletedAt])
  @@index([username])
  @@map("users")
}
